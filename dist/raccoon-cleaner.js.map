{"version":3,"file":"raccoon-cleaner.js","sources":["../src/raccoon-cleaner.js"],"sourcesContent":["/* ------------------------------------------------------------------\n   RaccoonCleaner: drop-in “trash-panda” clear-button + animation\n   © 2025  — MIT licence\n------------------------------------------------------------------ */\nexport class RaccoonCleaner{\n  static initAll(){\n    document.querySelectorAll('.raccoon-cleaner')\n            .forEach(el=>new RaccoonCleaner(el));\n  }\n  constructor(field){\n    this.f = field;\n    this.buildDOM();\n    this.bind();\n    this.sync();                     // initial alignment / visibility\n  }\n\n  /* ---------- scaffold ---------- */\n  buildDOM(){\n    // wrap the field so absolutely-positioned bits have a ref\n    this.wrap = document.createElement('span');\n    this.wrap.className = 'rac-wrap';\n    this.f.parentNode.insertBefore(this.wrap, this.f);\n    this.wrap.appendChild(this.f);\n\n    // bin button\n    this.bin = document.createElement('button');\n    this.bin.className = 'rac-bin';\n    this.bin.textContent='🗑️'; // trash-can\n    this.bin.setAttribute('aria-label','Clear');\n    this.wrap.appendChild(this.bin);\n  }\n\n  /* ---------- events ---------- */\n  bind(){\n    this.f.addEventListener('input',   ()=>this.sync());\n    window.addEventListener('resize',  ()=>this.sync());\n    this.bin.addEventListener('click', ()=>this.runShow());\n  }\n\n  /* ---------- keep bin aligned + show/hide ---------- */\n  sync(){\n    const hasText = !!this.f.value.trim();\n    if(!this.cleaning){\n      this.bin.classList.toggle('show', hasText);\n    }\n    // vertical align\n    const r      = this.f.getBoundingClientRect();\n    const styles = getComputedStyle(this.f);\n    const pt     = parseFloat(styles.paddingTop);\n    const pb     = parseFloat(styles.paddingBottom);\n    const mid    = pt + (r.height - pt - pb)/2;\n    this.bin.style.top = `${mid}px`;\n  }\n\n  /* ---------- the big animation ---------- */\n  runShow(){\n    if(!this.f.value.trim() || this.cleaning) return;\n    this.cleaning = true;\n    this.bin.classList.add('busy');\n\n    /* save + disable field */\n    const ph = this.f.placeholder;\n    this.f.placeholder = '';\n    this.f.disabled    = true;\n\n    /* clone word */\n    const txt = document.createElement('span');\n    txt.className = 'rac-txt';\n    txt.textContent = this.f.value;\n    this.wrap.appendChild(txt);\n    /* match the input's font size so dragged text aligns visually */\n    txt.style.fontSize = getComputedStyle(this.f).fontSize;\n\n    /* spawn raccoon at bin */\n    const coon = document.createElement('span');\n    coon.className = 'rac-coon';\n    coon.textContent = '🦝'; // raccoon\n    this.wrap.appendChild(coon);\n\n    /* geometry */\n    const wRect    = this.wrap.getBoundingClientRect();\n    const fRect    = this.f.getBoundingClientRect();\n    const styles   = getComputedStyle(this.f);\n    const leftPad  = parseFloat(styles.paddingLeft);\n    const borderL = parseFloat(styles.borderLeftWidth);\n    const glyphMid = parseFloat(styles.paddingTop) +\n                    (fRect.height - parseFloat(styles.paddingTop) -\n                                   parseFloat(styles.paddingBottom))/2;\n    txt.style.top = coon.style.top = `${glyphMid}px`;\n\n    const wordLeft = borderL + leftPad;   // account for input border\n    txt.style.left = `${wordLeft}px`;\n    const wordW = txt.getBoundingClientRect().width;\n    const binX  = wRect.width - parseFloat(styles.paddingRight) - 26; // ~bin\n    coon.style.left = `${binX}px`;\n\n    /* 1. walk LEFT to word */\n    const latch = wordLeft + wordW + 6;\n    const stepL = () => {                   // forward trot\n      const cx = parseFloat(coon.style.left);\n      if(cx - 8 > latch){\n        coon.style.left = `${cx - 8}px`;\n        requestAnimationFrame(stepL);\n      }else{\n        coon.style.left = `${latch}px`;\n        beginDrag();\n      }\n    };\n    stepL();\n\n    /* 2. back-drag to bin */\n    const beginDrag = () => {\n      this.f.value = '';\n      this.sync();  // empty UI now\n\n      const dist  = binX - wordLeft;\n      let moved   = 0;\n\n      function dragStep() {\n        const step = Math.min(12, dist - moved);   // 12‑px tug each step\n        moved += step;\n\n        txt.style.left  = `${wordLeft + moved}px`;\n        coon.style.left = `${latch   + moved}px`;\n\n        if (moved < dist) {\n          /* random stiff pauses 70‑170 ms */\n          setTimeout(dragStep, 70 + Math.random() * 100);\n        } else {\n          finish();\n        }\n      }\n      dragStep();\n    };\n\n    /* 3. fade + cleanup */\n    const finish = () => {\n      txt.style.opacity = coon.style.opacity = this.bin.style.opacity = 0;\n      setTimeout(()=>{\n        txt.remove(); coon.remove();\n        this.f.disabled   = false;\n        this.f.placeholder = ph;\n        this.bin.className = 'rac-bin';  // reset classes\n        this.bin.style.opacity = '';  // restore visibility for next use\n        this.cleaning = false;\n        this.sync();\n      }, 300);\n    };\n  }\n}\n\n/* auto-boot */\ndocument.addEventListener('DOMContentLoaded', ()=>RaccoonCleaner.initAll());"],"names":["RaccoonCleaner","initAll","document","querySelectorAll","forEach","el","constructor","field","this","f","buildDOM","bind","sync","wrap","createElement","className","parentNode","insertBefore","appendChild","bin","textContent","setAttribute","addEventListener","window","runShow","hasText","value","trim","cleaning","classList","toggle","r","getBoundingClientRect","styles","getComputedStyle","pt","parseFloat","paddingTop","pb","paddingBottom","mid","height","style","top","add","ph","placeholder","disabled","txt","fontSize","coon","wRect","fRect","leftPad","paddingLeft","borderL","borderLeftWidth","glyphMid","wordLeft","left","wordW","width","binX","paddingRight","latch","stepL","cx","requestAnimationFrame","beginDrag","dist","moved","dragStep","step","Math","min","setTimeout","random","finish","opacity","remove"],"mappings":"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"}